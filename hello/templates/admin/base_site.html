{% extends "admin/base.html" %}
{% load static %}
{% load usage_filters %}

{% block title %}ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ{% endblock %}

{% block content %}
<h1 style="text-align:right;">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ</h1>

<div style="direction:rtl; margin-top:30px;">
  <h2 onclick="toggleSection('daily')">Ù…ØµØ±Ù Ø±ÙˆØ²Ø§Ù†Ù‡</h2>
  <div id="daily" style="margin-bottom:30px; display:none;">
    <canvas id="dailyChart" height="120"></canvas>
  </div>

  <h2 onclick="toggleSection('monthly')">Ù…ØµØ±Ù Ù…Ø§Ù‡Ø§Ù†Ù‡</h2>
  <div id="monthly" style="margin-bottom:30px; display:none;">
    <canvas id="monthlyChart" height="120"></canvas>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script>
const dailyLabels = [{% for d in daily %}"{{ d.date }}",{% endfor %}];
const dailyData = [{% for d in daily %}{{ d.total_bytes_used|bytes_to_mb }},{% endfor %}];
const monthlyLabels = [{% for m in monthly %}"{{ m.year }}/{{ m.month }}",{% endfor %}];
const monthlyData = [{% for m in monthly %}{{ m.total_bytes_used }},{% endfor %}];

function toggleSection(id) {
  const section = document.getElementById(id);
  section.style.display = (section.style.display === "none" ? "block" : "none");
  if (id === 'daily') makeDailyChart();
  if (id === 'monthly') makeMonthlyChart();
}

function makeDailyChart() {
  const ctx = document.getElementById("dailyChart").getContext("2d");
  new Chart(ctx, { type:'bar', data:{ labels:dailyLabels, datasets:[{label:'Ù…ØµØ±Ù Ø±ÙˆØ²Ø§Ù†Ù‡', data:dailyData}] }});
}

function makeMonthlyChart() {
  const ctx = document.getElementById("monthlyChart").getContext("2d");
  new Chart(ctx, { type:'bar', data:{ labels:monthlyLabels, datasets:[{label:'Ù…ØµØ±Ù Ù…Ø§Ù‡Ø§Ù†Ù‡', data:monthlyData}] }});
}
</script>
<h3>ğŸ§ª ØªØ³Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ:</h3>
{% for d in daily %}
  <p>{{ d.date }} â†’ {{ d.total_bytes_used }} bytes â†’ {{ d.total_bytes_used|bytes_to_mb }} MB</p>
{% endfor %}
{% endblock %}